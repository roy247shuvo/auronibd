<div class="max-w-4xl mx-auto min-h-[600px]">
    <% if (!can('orders_label', 'write')) { %>
    <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6 rounded-r shadow-sm">
        <div class="flex">
            <div class="flex-shrink-0">
                <span class="material-icons-outlined text-yellow-400">lock</span>
            </div>
            <div class="ml-3">
                <p class="text-sm text-yellow-700">
                    <span class="font-bold">View Only Mode:</span> You do not have permission to modify label settings.
                </p>
            </div>
        </div>
    </div>
    <% } %>

    <div class="flex justify-between items-center mb-6">
        <div>
            <h1 class="text-2xl font-bold text-gray-900">Label Settings</h1>
            <p class="text-sm text-gray-500">Configure shipping label size (Inches).</p>
        </div>
    </div>

    <div class="bg-white rounded-xl shadow-sm border border-gray-200 max-w-2xl">
        <div class="p-8">
            <div class="mb-8">
                <label class="block text-xs font-bold text-gray-500 uppercase mb-3">Select Label Size</label>
                <div class="grid grid-cols-2 gap-4">
                    <button onclick="<%= can('orders_label', 'write') ? "selectLabelSize('3x4')" : '' %>" id="btn-3x4" class="label-btn border-2 border-gray-200 rounded-xl p-6 <%= can('orders_label', 'write') ? 'hover:border-black hover:bg-gray-50' : 'cursor-not-allowed opacity-60' %> transition text-center group">
                        <span class="block text-xl font-bold text-gray-700 group-hover:text-black mb-1">3" x 4"</span>
                        <span class="text-xs text-gray-400">Standard Shipping</span>
                    </button>
                    <button onclick="<%= can('orders_label', 'write') ? "selectLabelSize('5x6')" : '' %>" id="btn-5x6" class="label-btn border-2 border-gray-200 rounded-xl p-6 <%= can('orders_label', 'write') ? 'hover:border-black hover:bg-gray-50' : 'cursor-not-allowed opacity-60' %> transition text-center group">
                        <span class="block text-xl font-bold text-gray-700 group-hover:text-black mb-1">5" x 6"</span>
                        <span class="text-xs text-gray-400">Large Waybill</span>
                    </button>
                </div>
            </div>

            <div class="mb-8">
                <label class="block text-xs font-bold text-gray-500 uppercase mb-3">Sample Preview</label>
                <div class="bg-gray-100 rounded-xl p-8 flex items-center justify-center border border-gray-200 border-dashed min-h-[450px]">
                    
                    <div id="labelPreview" class="bg-white shadow-2xl border border-gray-300 transition-all duration-300 flex flex-col relative overflow-hidden text-black leading-none mx-auto origin-center">
                        
                        <div class="w-full h-full p-2 flex flex-col">
                            
                            <div class="text-center border-b-2 border-black pb-1 mb-1">
                                <div class="font-bold text-[10px] uppercase tracking-wider">Niche Boutique</div>
                                <div class="text-[6px] text-gray-600 mt-0.5">Dhaka, Bangladesh | 01700000000</div>
                            </div>

                            <div class="text-center mb-1">
                                <div class="font-extrabold text-[9px]">Order #NB-ON1024</div>
                                <div class="h-6 w-[90%] mx-auto bg-gray-800 my-0.5 flex items-center justify-center">
                                    <span class="text-white text-[6px] tracking-[2px]">||||||||||||||||</span>
                                </div>
                            </div>

                            <div class="border-2 border-black p-0.5 text-center mb-1 bg-gray-50">
                                <div class="text-[5px] font-bold uppercase text-gray-500">Steadfast ID</div>
                                <div class="text-[9px] font-black font-mono">12345678</div>
                            </div>

                            <div class="border-l-2 border-black pl-1 mb-1">
                                <div class="text-[5px] font-bold uppercase text-gray-500">Ship To:</div>
                                <div class="text-[8px] font-bold">John Doe</div>
                                <div class="text-[6px] leading-tight text-gray-600">House 12, Road 5, Dhanmondi, Dhaka</div>
                                <div class="text-[7px] font-bold mt-0.5">01712345678</div>
                            </div>

                            <div class="flex-1 border-t border-b border-dashed border-gray-300 py-1 mb-1">
                                <div class="text-[6px] font-bold text-gray-400 uppercase mb-0.5">Items:</div>
                                <div class="flex justify-between items-start mb-1">
                                    <div>
                                        <div class="text-[7px] font-bold">Cotton Shirt - Blue - M</div>
                                        <div class="text-[5px] text-gray-500 font-mono">SKU: CS-BL-M (x1)</div>
                                    </div>
                                    <div class="text-[7px] font-bold">1200</div>
                                </div>
                                <div class="flex justify-between items-start">
                                    <div>
                                        <div class="text-[7px] font-bold">Denim Pants - Black - 32</div>
                                        <div class="text-[5px] text-gray-500 font-mono">SKU: DP-BK-32 (x1)</div>
                                    </div>
                                    <div class="text-[7px] font-bold">1500</div>
                                </div>
                            </div>

                            <div class="bg-gray-900 text-white p-1 rounded-sm flex justify-between items-end">
                                <div>
                                    <div class="text-[5px] uppercase opacity-70">Total / Paid</div>
                                    <div class="text-[7px] font-bold">2700 / 0</div>
                                </div>
                                <div class="text-right">
                                    <div class="text-[5px] font-bold text-yellow-400">CASH ON DELIVERY</div>
                                    <div class="text-[10px] font-black leading-none">TK. 2700</div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>

            <% if (can('orders_label', 'write')) { %>
            <button onclick="saveBarcodeSetting()" class="w-full bg-black text-white font-bold py-3 rounded-xl hover:bg-gray-800 transition shadow-lg">
                Save Configuration
            </button>
            <% } %>
        </div>
    </div>
</div>

<script>
    let currentLabelSize = localStorage.getItem('barcodeLabelSize') || '3x4';

    document.addEventListener('DOMContentLoaded', () => {
        selectLabelSize(currentLabelSize);
    });

    function selectLabelSize(size) {
        currentLabelSize = size;
        
        // 1. Update Buttons
        document.querySelectorAll('.label-btn').forEach(btn => {
            btn.classList.remove('border-black', 'bg-gray-50', 'ring-2', 'ring-gray-200');
            btn.classList.add('border-gray-200');
        });
        const activeBtn = document.getElementById('btn-' + size);
        if(activeBtn) {
            activeBtn.classList.remove('border-gray-200');
            activeBtn.classList.add('border-black', 'bg-gray-50', 'ring-2', 'ring-gray-200');
        }

        // 2. Update Preview Dimensions (Scale approx: 1 inch = 96px)
        const preview = document.getElementById('labelPreview');
        let w, h;
        
        if(size === '3x4') { 
            // 3 inch = ~288px, 4 inch = ~384px
            w = '260px'; 
            h = '346px'; 
            preview.style.fontSize = '12px'; // Base scale
        } else { 
            // 5 inch = ~480px, 6 inch = ~576px (Scaled down slightly to fit UI)
            w = '360px'; 
            h = '432px'; 
            preview.style.fontSize = '14px'; // Slightly larger base scale
        }

        preview.style.width = w;
        preview.style.height = h;
    }

    function saveBarcodeSetting() {
        localStorage.setItem('barcodeLabelSize', currentLabelSize);
        alert('Label size saved: ' + currentLabelSize);
    }
</script>