<style>
    @import url('https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;500;600;700&display=swap');

    /* Font Setup */
    .font-bangla-title {
        font-family: 'Ekushey Punarbhaba', 'Hind Siliguri', serif;
    }
    .font-bangla-body {
        font-family: 'Hind Siliguri', sans-serif;
    }

    /* Animated Gradient Border */
    .gradient-border {
        position: relative;
        background: #fff;
        z-index: 1;
        border-radius: 0.75rem; /* rounded-xl */
    }
    .gradient-border::before {
        content: "";
        position: absolute;
        inset: -2px;
        z-index: -1;
        background: linear-gradient(45deg, #ff595e, #ffca3a, #8ac926, #1982c4, #6a4c93);
        background-size: 400% 400%;
        animation: gradientShift 5s ease infinite;
        border-radius: 0.85rem;
    }

    @keyframes gradientShift {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }

    /* Floating Flower Animation */
    .floating-flower {
        animation: float 6s ease-in-out infinite;
    }
    .floating-flower-delayed {
        animation: float 6s ease-in-out infinite 3s;
    }
    @keyframes float {
        0% { transform: translateY(0px) rotate(0deg); }
        50% { transform: translateY(-10px) rotate(10deg); }
        100% { transform: translateY(0px) rotate(0deg); }
    }
</style>

<div class="pt-32 pb-20 bg-orange-50/30 font-bangla-body relative min-h-[80vh] overflow-hidden">
    
    <div class="absolute top-20 left-5 text-orange-200 opacity-50 floating-flower pointer-events-none">
        <span class="material-icons-outlined text-7xl">local_shipping</span>
    </div>
    <div class="absolute bottom-10 right-5 text-red-200 opacity-50 floating-flower-delayed pointer-events-none">
        <span class="material-icons-outlined text-9xl">location_on</span>
    </div>

    <div class="max-w-4xl mx-auto px-6 relative z-10">
        
        <% if (!order) { %>
            <div class="max-w-lg mx-auto" x-data="{ phone: '', loading: false }">
                
                <div class="text-center mb-10">
                    <h1 class="font-bangla-title text-4xl md:text-5xl text-[#800000] mb-4 drop-shadow-sm">
                        অর্ডার ট্র্যাক করুন
                    </h1>
                    <p class="text-gray-600 text-sm leading-relaxed">
                        আপনার পার্সেলটি কোথায় আছে জানতে অর্ডার আইডি এবং ফোন নম্বর দিন।
                    </p>
                </div>

                <div class="gradient-border p-[3px] shadow-2xl">
                    <div class="bg-white p-8 rounded-xl relative overflow-hidden">
                        
                        <div x-show="loading" class="absolute inset-0 bg-white/90 z-20 flex flex-col items-center justify-center backdrop-blur-sm" style="display: none;">
                            <span class="material-icons-outlined text-4xl text-[#800000] animate-spin mb-2">autorenew</span>
                            <span class="text-xs font-bold text-gray-500 uppercase tracking-widest font-bangla-body">খোঁজা হচ্ছে...</span>
                        </div>

                        <form action="/track" method="POST" @submit="loading = true" class="space-y-6">
                            <input type="hidden" name="_csrf" value="<%= csrfToken %>">

                            <div>
                                <label class="block text-xs font-bold uppercase text-gray-500 mb-2 ml-1">অর্ডার আইডি (Order ID)</label>
                                <div class="relative group">
                                    <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                                        <span class="material-icons-outlined text-gray-400 group-focus-within:text-[#800000] transition-colors">receipt</span>
                                    </div>
                                    <input type="text" name="order_id" value="<%= prefillOrder %>" placeholder="AR-00001" 
                                        class="w-full bg-gray-50 border-2 border-gray-100 text-gray-900 text-sm rounded-lg focus:ring-0 focus:border-[#800000] block w-full pl-12 p-3.5 transition-all font-mono uppercase placeholder-gray-300 shadow-sm" required>
                                </div>
                            </div>

                            <div>
                                <label class="block text-xs font-bold uppercase text-gray-500 mb-2 ml-1">ফোন নম্বর (Phone Number)</label>
                                <div class="relative group">
                                    <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                                        <span class="material-icons-outlined text-gray-400 group-focus-within:text-[#800000] transition-colors">smartphone</span>
                                    </div>
                                    <input type="tel" name="phone" x-model="phone" placeholder="017XXXXXXXX" maxlength="11" required 
                                        class="w-full bg-gray-50 border-2 border-gray-100 text-gray-900 text-sm rounded-lg focus:ring-0 focus:border-[#800000] block w-full pl-12 p-3.5 transition-all font-mono tracking-widest shadow-sm"
                                        :class="{
                                            'border-red-300 bg-red-50 text-red-900 focus:border-red-500': phone.length > 0 && (!phone.startsWith('01') || phone.length < 11),
                                            'border-green-300 bg-green-50 text-green-900 focus:border-green-500': phone.length === 11 && /^01\d{9}$/.test(phone)
                                        }"
                                        oninput="this.value = this.value.replace(/[^0-9]/g, '')">
                                </div>
                                
                                <div class="h-4 mt-1 ml-1">
                                    <p x-show="phone.length > 0 && !phone.startsWith('01')" class="text-red-500 text-[10px] font-bold flex items-center gap-1 animate-pulse" style="display: none;">
                                        <span class="material-icons-outlined text-[12px]">error</span> অবশ্যই ০১ দিয়ে শুরু হতে হবে
                                    </p>
                                    <p x-show="phone.length === 11 && /^01\d{9}$/.test(phone)" class="text-green-600 text-[10px] font-bold flex items-center gap-1 animate-fade-in" style="display: none;">
                                        <span class="material-icons-outlined text-[12px]">check_circle</span> সঠিক নম্বর
                                    </p>
                                </div>
                            </div>

                            <button type="submit" class="w-full bg-gray-900 text-white text-sm font-bold uppercase tracking-widest py-4 rounded-lg hover:bg-black transition-all shadow-lg hover:shadow-xl flex items-center justify-center gap-2 group relative overflow-hidden">
                                <span class="relative z-10 flex items-center gap-2">
                                    ট্র্যাক করুন <span class="material-icons-outlined text-lg group-hover:translate-x-1 transition-transform">arrow_forward</span>
                                </span>
                                <div class="absolute inset-0 bg-[#800000] transform scale-x-0 group-hover:scale-x-100 transition-transform origin-left duration-300"></div>
                            </button>
                        </form>

                        <% if (error) { %>
                            <div class="mt-6 p-4 bg-red-50 text-red-800 text-xs font-bold rounded-lg border border-red-200 flex items-center gap-3 animate-[bounce_1s_ease-in-out_1]">
                                <span class="material-icons-outlined text-xl">warning</span>
                                <%= error %>
                            </div>
                        <% } %>
                    </div>
                </div>
            </div>

        <% } else { %>
            
            <div class="animate-fade-up">
                <a href="/track" class="inline-flex items-center gap-2 text-gray-500 hover:text-[#800000] text-xs font-bold uppercase tracking-widest mb-8 transition-colors group font-bangla-body">
                    <span class="material-icons-outlined text-sm group-hover:-translate-x-1 transition-transform">arrow_back</span> অন্য অর্ডার খুঁজুন
                </a>

                <div class="grid md:grid-cols-2 gap-8">
                    
                    <div class="bg-white p-8 rounded-xl shadow-lg border-t-4 border-[#800000] relative h-fit md:sticky md:top-24">
                        <div class="flex items-center gap-3 mb-6 border-b border-gray-100 pb-4">
                            <div class="w-12 h-12 rounded-full bg-red-50 text-[#800000] flex items-center justify-center animate-pulse">
                                <span class="material-icons-outlined text-xl">shopping_bag</span>
                            </div>
                            <div>
                                <h3 class="font-bangla-title text-2xl font-bold text-gray-900">অর্ডারের বিস্তারিত</h3>
                                <span class="text-xs text-gray-400 font-mono">#<%= order.order_number %></span>
                            </div>
                        </div>

                        <div class="space-y-4 text-sm font-sans text-gray-600 font-bangla-body">
                            <div class="flex justify-between items-center bg-gray-50 p-3 rounded-lg">
                                <span class="text-xs font-bold uppercase text-gray-400">বর্তমান অবস্থা</span>
                                <span class="inline-flex px-3 py-1 rounded-full bg-green-100 text-green-700 text-xs font-bold uppercase tracking-wide border border-green-200">
                                    <%= order.status %>
                                </span>
                            </div>
                            
                            <div class="space-y-2 pt-2">
                                <div class="flex justify-between"><span>কাস্টমার</span> <span class="font-bold text-gray-900"><%= order.guest_name %></span></div>
                                <div class="flex justify-between"><span>মোট টাকা</span> <span class="font-bold text-gray-900 font-mono">Tk. <%= order.total_amount %></span></div>
                                <div class="flex justify-between"><span>পরিশোধ</span> <span class="font-bold text-green-600 font-mono">Tk. <%= order.paid_amount %></span></div>
                                <div class="flex justify-between border-t border-dashed border-gray-200 pt-2 mt-2">
                                    <span class="text-red-500 font-bold">বাকি আছে</span> 
                                    <span class="font-bold text-red-600 text-lg font-mono">Tk. <%= order.due_amount %></span>
                                </div>
                            </div>
                        </div>

                        <div class="mt-8 bg-blue-50 p-4 rounded-lg border border-blue-100">
                            <p class="text-[10px] text-blue-500 uppercase font-bold tracking-widest mb-2 flex items-center gap-1 font-bangla-body">
                                <span class="material-icons-outlined text-sm">share</span> লিংক শেয়ার করুন
                            </p>
                            <div class="flex gap-2">
                                <input type="text" value="<%= order.secret_link %>" readonly class="flex-1 text-xs bg-white border border-blue-200 rounded px-3 py-2 text-gray-600 focus:outline-none font-mono">
                                <button onclick="navigator.clipboard.writeText('<%= order.secret_link %>'); this.innerHTML = 'কপি হয়েছে!'; setTimeout(() => this.innerHTML = 'কপি', 2000);" 
                                        class="text-xs bg-blue-600 text-white px-4 py-2 rounded font-bold hover:bg-blue-700 transition shadow-md font-bangla-body">
                                    কপি
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white border-2 border-gray-100 p-8 rounded-xl shadow-lg relative overflow-hidden">
                        <span class="material-icons-outlined absolute -right-6 -top-6 text-9xl text-gray-50 opacity-50 rotate-12">local_shipping</span>
                        
                        <h3 class="font-bangla-title text-2xl font-bold text-gray-900 mb-8 flex items-center gap-2 relative z-10">
                            <span class="material-icons-outlined text-[#800000] animate-bounce">local_shipping</span> 
                            শিপমেন্ট আপডেট
                        </h3>
                        
                        <% if (timeline.length === 0) { %>
                            <div class="text-center py-12 flex flex-col items-center relative z-10 font-bangla-body">
                                <div class="w-20 h-20 bg-gray-50 rounded-full flex items-center justify-center mb-4 border border-gray-200">
                                    <span class="material-icons-outlined text-gray-400 text-4xl animate-pulse">pending</span>
                                </div>
                                <p class="text-gray-900 font-bold text-lg">অর্ডারটি সফলভাবে প্লেস হয়েছে</p>
                                <p class="text-gray-500 text-sm mt-1">আমরা আপনার পার্সেলটি প্রস্তুত করছি। শীঘ্রই আপডেট আসবে!</p>
                            </div>
                        <% } else { %>
                            <div class="relative border-l-2 border-gray-200 ml-3 space-y-10 z-10">
                                <% timeline.forEach((item, index) => { %>
                                    <div class="relative pl-8 group">
                                        <span class="absolute -left-[9px] top-1.5 w-4 h-4 rounded-full border-2 border-white shadow-md transition-all duration-300 group-hover:scale-125 
                                            <%= index === 0 ? 'bg-green-500 ring-4 ring-green-100 animate-pulse' : 'bg-gray-300' %>">
                                        </span>
                                        
                                        <div class="<%= index === 0 ? 'opacity-100' : 'opacity-70 group-hover:opacity-100 transition-opacity' %>">
                                            <p class="text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-1 font-mono">
                                                <%= new Date(item.time).toLocaleString('en-US', { day: 'numeric', month: 'short', hour: 'numeric', minute: 'numeric', hour12: true }) %>
                                            </p>
                                            
                                            <p class="font-bold text-gray-800 text-sm md:text-base leading-relaxed font-bangla-body">
                                                <%= item.vibe_msg %>
                                            </p>

                                            <% if (item.is_rider_msg && item.rider_phone) { %>
                                                <div class="mt-4 bg-green-50 p-4 rounded-xl border border-green-200 shadow-sm flex items-center justify-between group-hover:shadow-md transition-shadow">
                                                    <div>
                                                        <p class="text-[10px] text-green-600 uppercase font-bold tracking-wider font-bangla-body">রাইডার</p>
                                                        <p class="text-sm font-bold text-green-900"><%= item.rider_name || 'Steadfast Rider' %></p>
                                                    </div>
                                                    <a href="tel:<%= item.rider_phone %>" class="flex items-center gap-2 bg-green-600 text-white text-[10px] font-bold uppercase tracking-widest px-4 py-2 rounded-full hover:bg-green-700 transition shadow hover:scale-105 font-bangla-body">
                                                        <span class="material-icons-outlined text-sm">call</span>
                                                        কল দিন
                                                    </a>
                                                </div>
                                            <% } %>

                                            <% if (item.original && item.original.toLowerCase().includes('delivered')) { %>
                                                <div class="mt-4">
                                                    <a href="https://www.facebook.com/auronishop" target="_blank" class="inline-flex items-center gap-2 text-xs bg-blue-50 text-blue-700 font-bold px-4 py-2 rounded-full border border-blue-100 hover:bg-blue-100 transition font-bangla-body">
                                                        <svg class="w-4 h-4 fill-current" viewBox="0 0 24 24"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
                                                        ফেসবুকে রিভিউ দিন
                                                    </a>
                                                </div>
                                            <% } %>
                                        </div>
                                    </div>
                                <% }) %>
                            </div>
                        <% } %>
                    </div>
                </div>
            </div>
        <% } %>
    </div>
</div>